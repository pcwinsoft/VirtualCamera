//==========================================================================;
//
//  THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY
//  KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
//  IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR
//  PURPOSE.
//
//  Copyright (c) 1992 - 1997  Microsoft Corporation.  All Rights Reserved.
//
//==========================================================================;

#include "strmini.h"
#include "ksmedia.h"
#include "capmain.h"
#include "capdebug.h"
#include "capxfer.h"

//
// EIA-189-A Standard color bar definitions
//

// 75% Amplitude, 100% Saturation
const static UCHAR NTSCColorBars75Amp100SatRGB24 [3][8] = 
{
//  Whi Yel Cya Grn Mag Red Blu Blk
    191,  0,191,  0,191,  0,191,  0,    // Blue
    191,191,191,191,  0,  0,  0,  0,    // Green
    191,191,  0,  0,191,191,  0,  0,    // Red
};

// 100% Amplitude, 100% Saturation
const static UCHAR NTSCColorBars100Amp100SatRGB24 [3][8] = 
{
//  Whi Yel Cya Grn Mag Red Blu Blk
    255,  0,255,  0,255,  0,255,  0,    // Blue
    255,255,255,255,  0,  0,  0,  0,    // Green
    255,255,  0,  0,255,255,  0,  0,    // Red
};

const static UCHAR NTSCColorBars100Amp100SatYUV [4][8] = 
{
//  Whi Yel Cya Grn Mag Red Blu Blk
    128, 16,166, 54,202, 90,240,128,    // U
    235,211,170,145,106, 81, 41, 16,    // Y
    128,146, 16, 34,222,240,109,128,    // V
    235,211,170,145,106, 81, 41, 16     // Y
};

UCHAR cbitmap01[32][16] = {
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0x0f,0xff,0xff,0xff,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0x0f,0xff,0x00,
0x0f,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0xff,
0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0x00,0xff,0xff,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0x00,0x0f,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0x00,0x0f,0xff,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xf0,
0x00,0x0f,0xff,0xff,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
};
UCHAR cbitmap02[32][16] = {
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0xff,0xff,0xff,0xf0,0x00,0x0f,0xff,0xff,0xf0,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x0f,0xff,0xf0,0x00,0x00,0x00,0xff,
0x0f,0xf0,0x00,0xff,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xf0,0x00,0xff,0x00,0x0f,0xff,0xf0,0x00,0xff,0xff,0xf0,0x00,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xf0,0x00,0xff,0xff,0xf0,0x00,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,
0xff,0xf0,0x00,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x0f,0xff,0xf0,0x00,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x0f,0xff,0xf0,0x00,0xff,0xff,0xf0,0x00,0xff,0xf0,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,
0x0f,0xf0,0x00,0x0f,0xff,0xff,0x00,0xff,0xf0,0x00,0xff,0xf0,0x0f,0xff,0x00,0x0f,0xff,0xf0,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x0f,0xff,0xf0,0x00,0x00,0x00,0xff,0xff,0xf0,0x00,0xf0,0x00,0xff,0xff,0x00,0x00,0xff,0xff,0xff,0xf0,0x00,0x0f,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
};
UCHAR cbitmap03[32][16] = {
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0xff,0xff,0x00,0x0f,0xff,0xff,0xf0,0x00,0x00,0xff,0xff,0xff,0xf0,0x00,0xf0,0x00,0xff,0xff,0x00,0x0f,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,
0xf0,0x00,0xff,0xff,0x00,0x0f,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xf0,0x00,0xff,0xf0,0x00,0xff,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0xf0,0x00,0x0f,0xf0,0x00,0xff,0xf0,0x00,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0x00,0xff,0xf0,0x00,0xff,
0xf0,0x00,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0xf0,0x00,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0xf0,0x00,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xf0,0x00,0x0f,0xf0,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xf0,0x0f,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0xf0,0x00,0xff,0xff,0xff,0x00,0xff,0xff,0x00,0x00,0xf0,0x00,0xf0,0x00,0x0f,0xff,0xff,0x00,0x0f,0xff,0xf0,0x00,0x0f,0xff,0xf0,0x00,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x00,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0x00,0x00,0xff,0xf0,0x00,0xff,0x00,0x0f,0x00,0x0f,0xff,0xff,
0x00,0x00,0xff,0xf0,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0xff,0x00,0x0f,0xff,0xff,0x00,0x00,0x0f,0xf0,0x00,0xff,0xf0,0x00,0xff,0x00,0x00,0xff,0x00,0x0f,0xff,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xf0,0x00,0xff,0xf0,0x00,0xff,0x00,0x0f,0xff,0xff,
0xff,0x00,0x0f,0xf0,0x00,0xff,0xf0,0x00,0xff,0xf0,0x00,0xff,0x00,0x0f,0xff,0xff,0x00,0x00,0x0f,0xf0,0x00,0xff,0xff,0x00,0x00,0xf0,0x00,0xff,0x00,0x0f,0xff,0xff,0x00,0x00,0xff,0xf0,0x00,0xff,0xff,0xf0,0x00,0x00,0x00,0xff,0x00,0x0f,0xff,0xff,
0x00,0xff,0xff,0xf0,0x00,0xff,0xff,0xff,0xff,0x00,0x00,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0xff,0xf0,0x0f,0xff,0xf0,0x00,0xff,0x00,0x00,0xff,0xff,0xff,0x00,0x0f,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x0f,0xff,0x00,0x00,0x00,0x00,
0xf0,0x00,0x0f,0x00,0x00,0x00,0xff,0xf0,0x00,0x00,0xff,0xff,0x00,0x0f,0x00,0x00,0x00,0x00,0xff,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0xff,0xff,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0x00,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
};
UCHAR cbitmap04[32][16] = {
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0xff,0x00,0x00,0xff,0x00,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x00,0x00,0x0f,
0x00,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xf0,0x00,0xf0,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xf0,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,
0xf0,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0x00,0x0f,0xf0,0x00,0xff,0xf0,0x00,
0xf0,0x00,0xff,0x00,0x00,0xff,0x00,0x00,0xff,0x00,0x0f,0xff,0x00,0xff,0xf0,0x00,0x00,0x0f,0xff,0x00,0x00,0x00,0x00,0xf0,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x0f,0x00,0xff,0xff,0x00,0x0f,0x00,0x0f,0xff,0x00,0x0f,0xff,0xff,0xff,0x00,0x00,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
};
UCHAR cbitmap05[32][16] = {
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0x00,0x0f,0xf0,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xf0,0x00,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0x00,0x0f,0xff,0xff,0x00,0x0f,0xf0,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0x00,0x0f,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0x00,0x0f,0xff,0xff,0xf0,0x00,0x0f,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0x00,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xf0,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0x00,0x00,0xff,0xff,0x00,0xff,0xff,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x00,0x00,0x0f,0xf0,0x00,0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x0f,0x00,0x0f,0xff,0x00,0x00,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff
};

/*
** ImageSynth()
**
**   Synthesizes NTSC color bars, white, black, and grayscale images
**
** Arguments:
**
**   pSrb - The stream request block for the Video stream
**   ImageXferCommands - Index specifying the image to generate
**
** Returns:
**
**   Nothing
**
** Side Effects:  none
*/

void ImageSynth (
    IN OUT PHW_STREAM_REQUEST_BLOCK pSrb,
    IN ImageXferCommands Command,
    IN BOOL FlipHorizontal
    )
{
    int                     StreamNumber = pSrb->StreamObject->StreamNumber; // it is zero becuase it is the 24rgb capture stream, we only hav that one
    PHW_DEVICE_EXTENSION    pHwDevExt = ((PHW_DEVICE_EXTENSION)pSrb->HwDeviceExtension);

    // this is the unique stream with id, buffer, and everything else
	PSTREAMEX               pStrmEx = (PSTREAMEX)pSrb->StreamObject->HwStreamExtension;

    KS_VIDEOINFOHEADER      *pVideoInfoHdr = pStrmEx->pVideoInfoHeader;

    UINT biWidth        =   pVideoInfoHdr->bmiHeader.biWidth;
    UINT biHeight       =   pVideoInfoHdr->bmiHeader.biHeight;
    UINT biSizeImage    =   pVideoInfoHdr->bmiHeader.biSizeImage;
    UINT biWidthBytes   =   KS_DIBWIDTHBYTES (pVideoInfoHdr->bmiHeader);
    UINT biBitCount     =   pVideoInfoHdr->bmiHeader.biBitCount;
    UINT LinesToCopy    =   abs (biHeight);
    DWORD biCompression =   pVideoInfoHdr->bmiHeader.biCompression;

    UINT                    Line;
    PUCHAR                  pLineBuffer;

    UINT                    LineToStart;
    UINT                    LineToEnd;
    UINT                    ColumnToStart;
    UINT                    ColumnToEnd;
	BOOL					bComplement;

    PKSSTREAM_HEADER        pDataPacket = pSrb->CommandData.DataBufferArray;
    PUCHAR                  pImage =  pDataPacket->Data;

    PUCHAR					pBlock[10];
    PUCHAR					pBlockSeg;
	int iy,iblock,ix;
	UCHAR ux;
	UCHAR u1,u2;
	BYTE b1,b2;
	int imy,imx;
	int index;

	UINT biWidthBytesFromStreamInfo;

    DEBUG_ASSERT (pSrb->NumberOfBuffers == 1);

    // 
    // Synthesize a single line of image data, which will then be replicated
    //

    pLineBuffer = &pStrmEx->LineBuffer[0];

    if ((biBitCount == 24) && (biCompression == KS_BI_RGB)) 
	{
        switch (Command) 
		{
		// this is the only one that runs to generate the 'start screencamera' background, classic tv test image
        case IMAGE_XFER_NTSC_EIA_100AMP_100SAT:
            // 100% saturation
            {
                UINT x, col;
                PUCHAR pT = pLineBuffer;
        
                for (x = 0; x < biWidth; x++) 
				{
                    col = (x * 8) / biWidth;
                    col = FlipHorizontal ? (7 - col) : col;
                    
                    *pT++ = NTSCColorBars100Amp100SatRGB24[0][col]; // Red
                    *pT++ = NTSCColorBars100Amp100SatRGB24[1][col]; // Green
                    *pT++ = NTSCColorBars100Amp100SatRGB24[2][col]; // Blue
                }
            }
            break;
		
			/*
        case IMAGE_XFER_NTSC_EIA_75AMP_100SAT:
            // 75% Saturation
            {
                UINT x, col;
                PUCHAR pT = pLineBuffer;
        
                for (x = 0; x < biWidth; x++) 
				{
                    col = (x * 8) / biWidth;
                    col = FlipHorizontal ? (7 - col) : col;

                    *pT++ = NTSCColorBars75Amp100SatRGB24[0][col]; // Red
                    *pT++ = NTSCColorBars75Amp100SatRGB24[1][col]; // Green
                    *pT++ = NTSCColorBars75Amp100SatRGB24[2][col]; // Blue
                }
            }
            break;
    
        case IMAGE_XFER_BLACK:
            // Camma corrected Grayscale ramp
            {
                UINT x, col;
                PUCHAR pT = pLineBuffer;
        
                for (x = 0; x < biWidth; x++) {
                    col = (255 * (x * 10) / biWidth) / 10;
                    col = FlipHorizontal ? (255 - col) : col;

                    *pT++ = (BYTE) col; // Red
                    *pT++ = (BYTE) col; // Green
                    *pT++ = (BYTE) col; // Blue
                }
            }
            break;
    
        case IMAGE_XFER_WHITE:
            // All white
            RtlFillMemory(pLineBuffer, biWidthBytes, (UCHAR) 255);
            break;
    
        case IMAGE_XFER_GRAY_INCREASING:
            // grayscale increasing with each image captured
            RtlFillMemory(pLineBuffer, biWidthBytes, (UCHAR) (pStrmEx->FrameInfo.PictureNumber * 8));
            break;
			*/
    
        default:
            break;
        }
    } // endif RGB24
    else 
	{
        TRAP;
    }


    // 
    // Copy the single line synthesized to all rows of the image
    //
	if (pHwDevExt->m_bheader == TRUE) // screencamera is running
	{
		// aqui se copia o buffer de vídeo que o ScreenCamera preencheu
		// e com ele se preenche o buffer de vídeo do driver
		// que pode ser então acessado como uma webcam

		// Lembrando que o ScreenCamera preenche vídeo para as N resoluções
		// conectadas

		for( ix=0; ix < TOTAL_VIDEO_BUFFERS; ix++ )
		{
			if (
				( pHwDevExt->m_VideoStream[ ix ].m_streamWidth ==  biWidth )
				&&
				( pHwDevExt->m_VideoStream[ ix ].m_streamHeigth == biHeight )
				)
			{
				
				//agefx
				//biWidthBytesFromStreamInfo = pHwDevExt->m_VideoStream[ ix ].m_streamWidth * 3;

				for (Line = 0; Line < LinesToCopy; Line++, pImage += biWidthBytes) 
				//for (Line = 0; Line < LinesToCopy; Line++, pImage += biWidthBytesFromStreamInfo) 
				{

					pLineBuffer = &pHwDevExt->m_VideoStream[ ix ].m_VideoBuffer[Line * biWidthBytes];

					//pLineBuffer = &pHwDevExt->m_VideoStream[ ix ].m_VideoBuffer[ Line * biWidthBytesFromStreamInfo ];

					RtlCopyMemory(pImage, pLineBuffer, biWidthBytes);

					//RtlCopyMemory(pImage, pLineBuffer, biWidthBytesFromStreamInfo);
				}

				break;
			}
		}
	}
	else
	{
		//desenhar o 'Start ScreenCamera'

		LineToStart = biHeight/2 - 16;
		LineToEnd = LineToStart + 31; 

		ColumnToStart = biWidth/2 - 80;
		ColumnToEnd = ColumnToStart + 160;

		bComplement = FALSE;

		for (Line = 0; Line < LinesToCopy; Line++, pImage += biWidthBytes) 
		{
			// desenhar o logo
			if (Line >= LineToStart && Line <= LineToEnd) {
				UINT j = 0;
				UINT k = 0;
				
				if (ColumnToStart > 0)
				{
					bComplement = TRUE;

					for (j = 0; j < ColumnToStart*3; j++) {
						*(pImage + j) = (UCHAR) 0xFF;
					}
				}

				imx = 0;
				imy = Line - LineToStart;

				pBlock[0] = (PUCHAR)&cbitmap01[imy][0];
				pBlock[1] = (PUCHAR)&cbitmap02[imy][0];
				pBlock[2] = (PUCHAR)&cbitmap03[imy][0];
				pBlock[3] = (PUCHAR)&cbitmap04[imy][0];
				pBlock[4] = (PUCHAR)&cbitmap05[imy][0];

				for(iblock=0;iblock<5;iblock++)
				{
					pBlockSeg = pBlock[iblock];
					
					for(ix=0;ix<16;ix++)
					{
						ux = pBlockSeg[ix];

						u1 = ux & 0xf0;
						u2 = ux & 0x0f;

						u1 = u1 >> 4;

						b1 = (BYTE) u1;
						b2 = (BYTE) u2;

						if (b1 == 0x0f)
						{
							*(pImage + j) = 0xff;j++;
							*(pImage + j) = 0xff;j++;
							*(pImage + j) = 0xff;j++;
						}
						else
						{
							*(pImage + j) = 0x00;j++;
							*(pImage + j) = 0x00;j++;
							*(pImage + j) = 0x00;j++;
						}

						imx++;

						if (b2 == 0x0f)
						{
							*(pImage + j) = 0xff;j++;
							*(pImage + j) = 0xff;j++;
							*(pImage + j) = 0xff;j++;
						}
						else
						{
							*(pImage + j) = 0x00;j++;
							*(pImage + j) = 0x00;j++;
							*(pImage + j) = 0x00;j++;
						}

						imx++;
					}
				}

				if (bComplement)
				{
					for (j = (ColumnToEnd*3); j < biWidthBytes; j++) {
						*(pImage + j) = (UCHAR) 0xFF;
					}
				}

				continue;
			}

			// Copy the synthesized line

			RtlCopyMemory(pImage, pLineBuffer, biWidthBytes);
		}
	}

    //
    // Report back the actual number of bytes copied to the destination buffer
    // (This can be smaller than the allocated buffer for compressed images)
    //

    pDataPacket->DataUsed = biSizeImage;
}

